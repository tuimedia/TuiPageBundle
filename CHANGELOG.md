# Changes

## 0.10.3

### FIXED

* Tolerate missing or empty block langdata

## 0.10.2

### BREAKING

* Minimum PHP version is now 8.1

## 0.10.1

### FIXED

* Moved source into `src/` folder to resolve a composer autoloader issue with rector config file

## 0.10.0

### BREAKING

* Minimum PHP version is now 8.0
* Minimum Symfony version is now 5.4
* No longer includes Swagger annotations
* Removed SchemaController

### CHANGED

* Route annotations are now attributes


## 0.9.6

### CHANGED

* Add Symfony 6.x to supported versions (actual support not guaranteed yet)

## 0.9.5

### FIXED

* SearchSubscriber no longer checks `isIndexable` when deleting Page entities.

## 0.9.4

### FIXED

* Fix error in pages:reindex command when indexing fewer pages than the bulk_index_threshold

## 0.9.3

### CHANGED

* Fix page list endpoint

## 0.9.2

## CHANGED

* Uses the official typesense client instead of making its own http calls. This adds retries, multi-server support, etc.

## 0.9.1

### NEW

* Defined `Tui\PageBundle\Entity\IsIndexableInterface`. Implement this in your Page entity to control whether a page is indexed or not. For convenience, AbstractPage implements this so you can simply override the `function isIndexable(): bool` method.

## 0.9.0

### BREAKING

Read [`UPGRADE-0.9.md`](./UPGRADE-0.9.md) for instructions on how to upgrade to this release.

* Search now uses Typesense instead of ElasticSearch. You'll need to set up a Typesense service and update your config and search transformer(s).
* If you've got any custom query classes, they'll need to be rewritten.
* The search functionality no longer indexes all page content. You must explicitly add the searchable content from your page components and metadata to the index document using a search transformer.
* `Tui\PageBundle\Search\TransformerInterface` has changed. The `transform()` method has been replaced with `transformDocument()` and a new `transformSchema()` method allows you to modify the Typesense index mapping during a reindex.
* Typesense currently has no "did you mean" functionality, so this has been removed from the search result output.
* UUID ids for AbstractPage and AbstractPageData are now generated by the symfony/uid component, and `json_array` properties have been changed to `json`. You will need to generate and run a doctrine diff migration. This is to add (optional!) support for doctrine/dbal version 3. See UPGRADE-0.9.md for details.
* The `Tui\PageBundle\Search\TranslatedPage` class which represented an ElasticSearch document is now an array representing a Typesense document. If you extended this class to add fields, use your search transformer instead (both `transformSchema()` to define the field, and `transformDocument()` to set it).
* `Tui\PageBundle\Search\TranslatedPageFactory->createFromPage` has been replaced with `Tui\PageBundle\Search\TypesenseClient->createSearchDocument()`

### NEW

* `Tui\PageBundle\Search\TypesenseClient` is a new search index and indexing client

### CHANGED

* Fix various deprecations in PHP 8.1 and Symfony 5.4

## 0.8.15

### CHANGED

* XLIFF translation export no longer includes empty or non-string values
* XLIFF translation import now initialises the target language with a copy of the default language langData

## 0.8.14

### NEW

* Added (e.g.) `valid_languages: ['en_GB', 'fr']` parameter to the config so you can reject unexpected translations.

### CHANGED

* Downgraded some bulk indexing messages from `info` to `debug`

## 0.8.13

### FIXED

* Bump http-foundation minimum version to 4.x or 5.0.4

## 0.8.12

### CHANGED

* A new `bulk_index_threshold` config setting allows you to set the number of pages in each indexing batch. The default is now 50.

## 0.8.11

### CHANGED

* The `pages:reindex` command now performs bulk indexing of 20 pages at a time for better performance.

## 0.8.10

### CHANGED

* The XLIFF import endpoint with the destination "original" will create a new revision

## 0.8.9

### CHANGED

* Include default & available languages in page lists
* Component schema docs have been moved into this package from @tuimedia/vue-page

## 0.8.8

### FIXED

* Disabled broken cache headers & checking in PageController::retrieve
* Fixed deprecated (and then broken) SearchSubscriber argument type

## 0.8.7

### FIXED

* Fix deprecation in checkTuiPagePermissions

## 0.8.6

### FIXED

* Exceptions thrown within the SearchSubscriber are no longer fatal. Instead they're logged as errors and execution continues.

## 0.8.5

I forgot how to count, I guess. This version never existed.

## 0.8.4

### FIXED

* Implement missing `search` permission check

## 0.8.3

### NEW

* A new `access_control` configuration array contains roles to check before performing each of the write actions on the API. This works in addition to the existing advice to set up an `access_control` rule on the security component. See the README for details on how to configure this.

## 0.8.1

### FIXED

* Fixed an exception in PageSchema while trying to validate a block with no langData in the default language.

## 0.8

### BREAKING

* The data format has changed:
  * `PageData.content` has an additional integer property: `schemaVersion`. If not provided, the old format is assumed.
  * `PageData.content.layout` is now an array of block ids. Layout blocks were always another kind of block, so keeping them together makes sense and reduces the amount of code.

### NEW

* A `pages:upgrade` command to migrate content from the old format to the new. This command is repeatable without problems, so you can make it part of your deployments. BACK UP YOUR DATABASE BEFORE RUNNING THIS.
